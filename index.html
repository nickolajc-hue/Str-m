<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Spotpris DK1</title>
  <style>
    body {
      background: #000;
      color: white;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 0;
      padding: 20px;
    }
    .center {
      text-align: center;
      margin-top: 40px;
    }
    .price {
      font-size: 56px;
      font-weight: bold;
    }
    .unit {
      font-size: 20px;
      opacity: 0.7;
    }
    .time {
      margin-top: 10px;
      font-size: 16px;
      opacity: 0.5;
    }
    .list {
      margin-top: 30px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      border-bottom: 1px solid #222;
      font-size: 18px;
    }
    .now {
      background: #2962ff;
    }
  </style>
</head>
<body>
  <div class="center">
    <div class="price" id="price">–</div>
    <div class="unit">kr / kWh</div>
    <div class="time" id="time">Henter pris…</div>

    <button onclick="toggleList()" style="margin-top:20px; padding:12px 20px; font-size:18px;">
      Se dagens priser
    </button>
  </div>

  <div class="list" id="dayList" style="display: none;"></div>

  <script>
    function toggleList(){
      const el = document.getElementById("dayList");
      el.style.display = (el.style.display === "none") ? "block" : "none";
    }

    async function loadPrices(){
      const today = new Date();
      const date = today.toISOString().split("T")[0];

      const filter = encodeURIComponent(JSON.stringify({
        PriceArea: "DK1",
        HourUTC: {
          gte: date + "T00:00:00Z",
          lte: date + "T23:59:59Z"
        }
      }));

      const url = `https://api.energidataservice.dk/dataset/Elspotprices?filter=${filter}&sort=HourUTC ASC&limit=24`;

      try {
        const res = await fetch(url);
        const data = await res.json();

        if (!data.records || data.records.length === 0) {
          document.getElementById("price").innerText = "Ingen data";
          return;
        }

        const nowHour = new Date().getHours();

        // vis aktuel pris
        const recNow = data.records.find(r =>
          new Date(r.HourUTC).getHours() === nowHour
        ) || data.records[0];
        const spotDKK = recNow.SpotPriceDKK / 1000;
        document.getElementById("price").innerText = spotDKK.toFixed(2);
        document.getElementById("time").innerText = "Gælder kl. " + String(nowHour).padStart(2, "0") + ":00";

        // lav liste med alle timer
        const listEl = document.getElementById("dayList");
        listEl.innerHTML = "";
        data.records.forEach(r => {
          const h = new Date(r.HourUTC).getHours();
          const price = (r.SpotPriceDKK / 1000).toFixed(2);
          const div = document.createElement("div");
          div.className = "row" + (h === nowHour ? " now" : "");
          div.innerHTML = `<span>${String(h).padStart(2,"0")}:00</span><span>${price} kr</span>`;
          listEl.appendChild(div);
        });

      } catch (err) {
        document.getElementById("price").innerText = "Fejl";
      }
    }

    loadPrices();
    setInterval(loadPrices, 60000);
  </script>
</body>
</html>
